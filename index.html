<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/svg+xml" href="/assets/fav.png">
    <title>cherri</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/uv/uv.bundle.js"></script>
    <script src="/uv/uv.config.js"></script>
    <script src="/baremux/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/assets/js/t.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@widgetbot/html-embed"></script>
    <script src="/sj/scramjet.all.js"></script>
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/assets/css/colors.css" id="css-theme-link">
    <link rel="stylesheet" href="/fa/css/all.css">
    <link rel="stylesheet" href="/fa/css/all.min.css">
    <link rel="stylesheet" href="/fa/css/solid.css">
    <link rel="stylesheet" href="/fa/css/all-pro.css">
    <link rel="stylesheet" href="/assets/css/t.css">
    <link rel="stylesheet" href="/assets/css/dropdown.css">
    <script src="/assets/js/colors.js"></script>
    <script src="/assets/js/splash.js" defer></script>
    <script src="/assets/js/browserfunctions.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eruda@3.4.3/eruda.min.js"></script>
    <script src="/assets/js/lib/particles.js"></script>

</html>
</head>

<body>
    <div class="grid"></div>
    <nav>
        <ul>
            <li style="width: 95px;">
                <a onclick="navTo('home')" style="margin-top: 7.5px; margin-left: 10px;" href="#" data-page="home">
                    <div class="hcontainer">
                        <img src="/assets/img/fav.png" style="height: 24px; margin-top: -1px; margin-right: 4px;"
                            alt="">
                        <p>cherri</p>
                    </div>
                </a>
            </li>
            <li>
                <a onclick="toggleGames()" href="#" data-page="games">
                    <i class="fas fa-gamepad"></i>
                </a>
            </li>
            <li>
                <a onclick="toggleApps()" href="#" data-page="apps">
                    <i class="fas fa-grid"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('movies')" href="#" data-page="movies">
                    <i class="fas fa-clapperboard"></i>
                </a>
            </li>
            <li>
                <a onclick="togglePartners()" href="#" data-page="movies">
                    <i class="fas fa-handshake-simple"></i>
                </a>
            </li>
            <!--
            <li>
                <a onclick="toggleChat()" href="#" data-page="social">
                    <i class="fas fa-messages"></i>
                </a>
            </li>
            -->
            <li class="toright" style="right: 60px;">
                <a onclick="toggleSettings()" href="#" data-page="settings">
                    <i class="fas fa-cog"></i>
                </a>
            </li>
            <li class="toright">
                <a target="_blank" href="https://discord.gg/hUYzETaQ9U" data-page="settings">
                    <i class="fa-brands fa-discord"></i>
                </a>
            </li>
        </ul>
    </nav>
    <div id="homeContent">
        <h1 class="text-7xl font-medium home-gradient">
            cherri</h1>
        <p id="splash" class="text-medium font-light text-white/50">
            wsp
        </p>
        <br>
        <div class="searchathome">
            <i class="fas fa-search"></i>
            <input id="homesearch" autocomplete="off" style="margin-right: -3%;" type="text"
                placeholder="search anything..." />
        </div>
        <br><br>
    </div>

    <div class="toast-container fixed right-4 top-4 w-1/4">
    </div>

    <div class="toast-container"></div>

    <iframe id="contentFrame"></iframe>

    <div class="settings-container settings-hidden">
        <div class="container">
            <div class="settings-sidebar vflex">
                <div class="settings-section" style="background: var(--bg-3);" onclick="switchSettingsPage('general')"
                    data-target="general">
                    <i class="fas fa-cog"></i>
                    General
                </div>
                <div class="settings-section" onclick="switchSettingsPage('cloaking')" data-target="cloaks">
                    <i class="far fa-hood-cloak"></i>
                    Cloaking
                </div>
                <div class="settings-section" onclick="switchSettingsPage('proxy')" data-target="proxy">
                    <i class="fas fa-browser"></i>
                    Proxy
                </div>
                <div class="settings-section" onclick="switchSettingsPage('info')" data-target="info">
                    <i class="far fa-file"></i>
                    Info
                </div>
            </div>

            <div class="settings-content-container">
                <div id="settings-general" class="settings-active settings-page">
                    <h2>Search Engine</h2>
                    <p>This is the search engine that the proxy will use with search queries.</p>
                    <div class="search-engine-selector">
                        <div class="search-engine-selected"></div>
                        <div class="search-engine-options">

                        </div>
                    </div>

                    <h2>Theme</h2>
                    <p>The color scheme used across the whole site. Refresh to see changes.</p>
                    <div class="theme-selector">
                        <div class="theme-selected"></div>
                        <div class="theme-options">

                        </div>
                    </div>

                    <h2>Game Library</h2>
                    <p>The set of games that the whole site uses! Refresh to see changes.</p>
                    <div class="store-selector">
                        <div class="store-selected"></div>
                        <div class="store-options">

                        </div>
                    </div>

                    <h2>Download Games</h2>
                    <p>Download all game stores.</p>
                    <button class="button" style="margin-left: 0;" onclick="toggleDownloadGames()">Download</button>

                    <br><br><br>
                </div>

                <div id="settings-cloaking" class="settings-page">
                    <h2>Tab Cloak</h2>
                    <p>How your tab will appear in history, on filtering extensions, and more.</p>
                    <div class="decoy-selector">
                        <div class="decoy-selected"></div>
                        <div class="decoy-options">

                        </div>
                    </div>

                    <br><br><br>
                </div>

                <div id="settings-proxy" class="settings-page">
                    <h2>Wisp Server</h2>
                    <p>The server that all content will be transferred through. Make sure the Wisp server you are using
                        is not blocked, or the proxy will not function.</p>
                    <div class="wisp-selector">
                        <div class="wisp-selected"></div>
                        <div class="wisp-options">

                        </div>
                    </div>
                    <h2>Backend</h2>
                    <p>The main proxy service. Scramjet is newer but more experimental, while Ultraviolet is older but
                        less advanced.</p>
                    <div class="backend-selector">
                        <div class="backend-selected"></div>
                        <div class="backend-options">

                        </div>
                    </div>

                    <br><br><br>
                </div>

                <div id="settings-info" class="settings-page">
                    <h2>Credits</h2>
                    <p>
                        <b style="font-weight: 500;">GN Math</b> - all games <br>
                        <b style="font-weight: 500;"><a href="https://waves.lat" target="_blank">Waves</a></b> - custom
                        dropdown, styling
                        inspiration <br>
                        <b style="font-weight: 500;">TitaniumNetwork</b> - Ultraviolet <br>
                        <b style="font-weight: 500;">Scramjet</b> - Libcurl and Scramjet <br>
                        <b style="font-weight: 500;"><a href="https://github.com/ambr0sial/nova"
                                target="_blank">Nova</a></b> - movies and TV
                        source <br>
                        <b style="font-weight: 500;">RHW, Terbium, and Anura</b> - Wisp servers <br>
                        <b style="font-weight: 500;"><a href="https://techno.pics/" target="_blank">technonyte</a></b> -
                        Emotional support <br>
                    </p>

                    <br>

                    <h2>Thank you!</h2>
                    <p>Thanks for using Cherri! We hope you enjoyed your stay, and maybe star us on the <a
                            href="https://github.com/x8rr/cherri" target="_blank">repository.</a></p>
                </div>
            </div>

            <p class="absolute bottom-4 text-[var(--text)] font-medium text-sm">cherri <span
                    class="opacity-70 bg-[var(--accent-2)] p-1 rounded-lg text-white"><a class="text-white"
                        href="https://github.com/x8rr/cherri/releases" target="_blank"
                        style="text-decoration: none;">beta 2.3</a></span></p>
        </div>
    </div>

    <div class="browser-container">
        <div class="browser-controls">
            <div class="tabs">
                <button class="newtab" onclick="newTab()">
                    <i class="far fa-plus"></i>
                </button>
            </div>
            <div class="browser-buttons">
                <div class="hcontainer">
                    <button onclick="b()">
                        <i class="far fa-chevron-left"></i>
                    </button>
                    <button onclick="f()">
                        <i class="far fa-chevron-right"></i>
                    </button>
                    <button onclick="r()">
                        <i class="far fa-rotate-right"></i>
                    </button>
                    <input type="text" id="searchbar" onkeydown="((e) => {
                        if (e.key === 'Enter' || e.key === 'enter') {
                            console.log('hi')
                            rSearch(this.value.trim())
                        }
                    })" placeholder="search anything...">
                    <button onclick="full()">
                        <i class="far fa-expand"></i>
                    </button>
                    <button onclick="launchEruda()">
                        <i class="far fa-square-code"></i>
                    </button>
                    <button onclick="hideBrowser()">
                        <i class="far fa-house"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="particles-container"></div>

    <div class="apps-wrapper settings-hidden">
        <input onkeyup="searchApps(this.value)" type="text" style="font-family: Arial;"
            placeholder="search through the apps..." id="apps-search"
            class="h-fit p-4 px-5 w-[975px] bg-[var(--bg-2)] border-none absolute left-1/2 translate-x-[-50%] rounded-2xl transition-all focus:bg-[var(--bg-3)] focus:outline-none ">
        <br><br><br>
        <div
            class="apps-container h-[83%] overflow-y-scroll w-[475px] flex flex-wrap w-7/8 absolute left-1/2 translate-x-[-50%] justify-center">
            <br>
        </div>
        <br>
    </div> 

    <div class="download-wrapper settings-hidden">
        <div style="text-align: center;">
            <br>
            <h1 style="font-size: 23px; margin-bottom: 10px;">Download Games</h1>
        </div>
        <div style="text-align: center;">
            <a href="https://drive.google.com/file/d/1jenQFXTxrgbNqfLYzH7ckVEC_hskECl1/view?usp=sharing" target="_blank">
                <button class="button">Google Drive 1</button>
            </a>
        </div>
        <br>
        <p style="opacity: .5; font-size: 14px; font-style: italic; text-align: center; ">more coming before gta 6 twin
            <br> :broken-heart: :wilted-rose: :low-battery:
        </p>
    </div>

    <div class="games-wrapper settings-hidden">
        <input onkeyup="searchApps(this.value)" type="text" style="font-family: Arial;"
            placeholder="search through the games..." id="apps-search"
            class="h-fit p-4 px-5 w-[975px] bg-[var(--bg-2)] border-none absolute left-1/2 translate-x-[-50%] rounded-2xl transition-all focus:bg-[var(--bg-3)] focus:outline-none ">
        <br><br><br>
        <div
            class="games-container h-[83%] overflow-y-scroll w-[475px] flex flex-wrap w-7/8 absolute left-1/2 translate-x-[-50%] justify-center">
            <br>
        </div>
        <br>
    </div>

    <div class="partners-wrapper settings-hidden">
        <br>
        <h1 style="text-align: center; font-size: 35px; color: var(--bright-text); font-weight: 500;">Partners</h1>
        <br>
        <p align="center">No partners yet.</p>
        <div
            class="partner-container h-[83%] overflow-y-scroll w-[475px] flex flex-wrap w-7/8 absolute left-1/2 translate-x-[-50%] justify-center">
            <!--
            <a href="https://prism.onl/" target="_blank">
                <div class="app">
                    <div class="bg-img" style="background: url('/assets/img/partners/prism.png');"></div>
                    <div class="app-title-cont">
                        <h2 class="app-title-h2">Prism</h2>
                </div>
            </a>
            -->
        </div>
    </div>
    <br>
    </div>

    <script src="/assets/js/dropdown.js"></script>
    <script>
        particlesJS.load("particles-container", "/assets/json/config/particles.json", () => {
            console.log("callback - particlsjs loaded")
        })
    </script>
    <script>
        const selectedStore = localStorage.getItem("cherri_gameStore").toLowerCase() ?? "classplay"

        let res
        let data

        async function gj(file) {
            res = await fetch(`/assets/json/${file}.json`);
            data = await res.json()
        }

        // welcome to my super bad json loader
        // time wasted trying to understand this craphole:
        // 1 hour(s)

        function load(file, type, functionName, toRun, additions) {
            gj(file).then(() => {
                console.log(
                    "%ccherri" + "%c recieved json data!",
                    "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                    "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                )
            }).then(() => {
                data.forEach(item => {
                    const aCont = document.querySelector(`.${type}-container`)
                    const newAppContainer = document.createElement("div")

                    newAppContainer.classList.add("app")
                    newAppContainer.setAttribute("onclick", `toggle${functionName}();${toRun}('${additions}${item.url}'); console.log("asdflkjgasdfkljhgasdfkhgasfjkhgasfjkhgsdfgjh")`)
                    newAppContainer.innerHTML = `
                        <div class="bg-img" style="background: url('${item.img}');"></div>
                        <div class="app-title-cont">
                            <h2 class="app-title-h2">${item.name}</h2>
                        </div>
                    `

                    aCont.appendChild(newAppContainer)
                })
            })
        }

        load("apps", "apps", "Apps", "rSearch", "")
        load(selectedStore, "games", "Games", "navTo", "play.html?launch=")

        function searchApps(term) {
            const apps = document.querySelectorAll(".app")
            apps.forEach((app) => {
                if (!app.querySelector("h2").textContent.toLowerCase().includes(term.toLowerCase())) {
                    app.style.display = "none"
                } else {
                    app.style.display = "block"
                }
            })
        }
    </script>
    <script>
        async function registerSW() {
            if ("serviceWorker" in navigator) {
                await navigator.serviceWorker.register("/uv/sw.js").then(() => {
                    console.log(
                        "%ccherri" + "%c UV sw registered!",
                        "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                        "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                    );
                    setTimeout(() => {
                        showToast("success", "Ultraviolet worker initialized!", "fas fa-check-circle")
                        console.log("shown toast")
                    }, 1000)
                }).catch(e => {
                    console.log("Error registering service worker (UV): " + e)
                    showToast("error", "Failed to register service worker", "fas fa-times-circle")
                });

                await navigator.serviceWorker.register("/sw.js").then(() => {
                    console.log(
                        "%ccherri" + "%c SJ sw registered!",
                        "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                        "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                    );
                    setTimeout(() => {
                        showToast("success", "Scramjet worker initialized", "fas fa-check-circle")
                        console.log("shown toast")
                    }, 1000)
                }).catch(e => {
                    console.log("Error registering service worker (SJ): " + e)
                    showToast("error", "Failed to register service worker", "fas fa-times-circle")
                });
            }
        }

        window.addEventListener("load", () => {
            registerSW();
            lucide.createIcons();
        });

        const contentFrame = document.getElementById('contentFrame');
        const homeContent = document.getElementById('homeContent');
        const navLinks = document.querySelectorAll('nav a[data-page]');

        function navTo(l) {
            if (l === "home") {
                contentFrame.remove();
                homeContent.style.display = "block";
            } else {
                if (!document.body.contains(contentFrame)) {
                    document.body.appendChild(contentFrame);
                }
                homeContent.style.display = "none";
                contentFrame.style.display = "block";
                contentFrame.src = l.includes("/stores/") ? `/pages/${l}` : `/pages/${l}.html`;
            }
        }

    </script>
    <script>
        let aTab = 0
        let tabCounter = 1
        let bTabs = []
        const tabCont = document.querySelector(".tabs")
        let tabFrame
        let fUrl
        const inp = document.getElementById("searchbar")
    </script>
    <script>

        inp.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                nav(inp.value)
                console.log("i")
            }
        })
    </script>
    <script>
        const connection = new BareMux.BareMuxConnection("/baremux/worker.js")
        const wispUrl = localStorage.getItem("cherri_wispUrl") || "wss://wisp.rhw.one/"
        const bareUrl = "https://useclassplay.vercel.app/fq/"
    </script>
    <script>
        const CONFIG = {
            files: {
                wasm: "/sj/scramjet.wasm.wasm",
                all: "/sj/scramjet.all.js",
                sync: "/sj/scramjet.sync.js",
            }
        }

        const { ScramjetController } = $scramjetLoadController()
        const scramjet = new ScramjetController({
            files: CONFIG.files,
        })
        scramjet.init()


    </script>
    <script defer>
        window.addEventListener("load", () => {
            const frames = document.querySelectorAll(".viewframe")
            const activeFrames = document.querySelectorAll(".active")

            activeFrames.forEach(frame => {
                frame.classList.remove("active")
            })
        })
    </script>
    <script defer>
        const settingsHolder = document.querySelector(".settings-container")
        const settingsViewframe = document.querySelector(".settings-content-container")

        const appsHolder = document.querySelector(".apps-wrapper")
        const gamesHolder = document.querySelector(".games-wrapper")
        const downloadHolder = document.querySelector(".download-wrapper")
        const partnerHolder = document.querySelector(".partners-wrapper")

        const general = document.querySelector("#settings-general")
        const cloaking = document.querySelector("#settings-cloaking")
        const proxy = document.querySelector("#settings-proxy")
        const cookes = document.querySelector("#settings-cookies")
        const info = document.querySelector("#settings-info")

        const allPages = document.querySelectorAll(".settings-page")
        const allButtons = document.querySelectorAll(".settings-section")

        function switchSettingsPage(target) {
            allPages.forEach(page => {
                page?.classList.remove("settings-active")
                document.querySelector(`#settings-${target}`)?.classList.add("settings-active")
            })
        }

        allButtons.forEach(button => {
            button.addEventListener("click", () => {
                allButtons.forEach(btn => {
                    btn.style.background = ""
                    button.style.background = "var(--bg-3)"
                })
            })
        })

        function toggleSettings() {
            if (settingsHolder.classList.contains("settings-hidden")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    toggleSettings()
                })
                settingsHolder.classList.remove("settings-hidden")
                settingsHolder.classList.add("settings-shown")
            } else {
                settingsHolder.classList.remove("settings-shown")
                settingsHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }
        function toggleApps() {
            if (appsHolder.classList.contains("settings-hidden")) {
                if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    toggleApps()
                })
                appsHolder.classList.remove("settings-hidden")
                appsHolder.classList.add("settings-shown")
                console.log("Apps toggled.")
            } else {
                appsHolder.classList.remove("settings-shown")
                appsHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }

        function toggleDownloadGames() {
            if (downloadHolder.classList.contains("settings-hidden")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    toggleDownloadGames()
                })
                downloadHolder.classList.remove("settings-hidden")
                downloadHolder.classList.add("settings-shown")
                console.log("Apps toggled.")
            } else {
                downloadHolder.classList.remove("settings-shown")
                downloadHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }

        function toggleGames() {
            if (gamesHolder.classList.contains("settings-hidden")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    console.log("clicked")
                    toggleGames()
                })
                gamesHolder.classList.remove("settings-hidden")
                gamesHolder.classList.add("settings-shown")
            } else {
                gamesHolder.classList.remove("settings-shown")
                gamesHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }

        function togglePartners() {
            if (partnerHolder.classList.contains("settings-hidden")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    console.log("clicked")
                    togglePartners()
                })
                partnerHolder.classList.remove("settings-hidden")
                partnerHolder.classList.add("settings-shown")
            } else {
                partnerHolder.classList.remove("settings-shown")
                partnerHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }

        function rSearch(input) {
            const aw = document.querySelector(".apps-wrapper")

            if (aw.classList.contains("settings-shown")) {
                toggleApps()
            }

            let url = input;
            if (!url.includes(".") || url.includes(" ")) {
                url = "https://search.brave.com/search?q=" + url;
            } else {
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url;
                }
            }

            const b = document.querySelector(".browser-container")
            const frames = document.querySelectorAll(".viewframe")

            b.style.opacity = 1
            b.style.pointerEvents = "all"

            frames.forEach(frame => {
                frame.style.opacity = 1
                frame.style.pointerEvents = "all"
            })

            console.log("rSearch")
            newTab()
            nav(url)
            switchTab(aTab)
        }
    </script>
    <script>
        let searchE

        const se = localStorage.getItem("cherri_searchEngine") || "DuckDuckGo"
        const bar = document.getElementById("urlbar")

        if (se === "DuckDuckGo") {
            searchE = "https://duckduckgo.com/search?q="
        } else if (se === "Bing") {
            searchE = "https://bing.com/search?q="
        } else if (se === "Google") {
            searchE = "https://google.com/search?q="
        } else if (se === "Startpage") {
            searchE = "https://startpage.com/search?q="
        } else if (se === "https://qwant.com/search?q=") {
            bar.placeholder = "Search with Qwant or enter a URL here"
        } else {
            bar.placeholder = "Search with Brave or enter a URL here"
        }
        connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }])

        function newTab() {
            const nTab = {
                id: tabCounter++,
                title: "New Tab",
                url: "",
                history: [],
                historyIndex: -1,
            };

            bTabs.push(nTab)
            if (!tabCont) return

            const ntBtn = document.querySelector('.newtab')

            const tabElement = document.createElement("div")
            tabElement.classList.add("tab", "hcontainer")
            tabElement.dataset.tabId = nTab.id
            tabElement.innerHTML = `
                <img src="/assets/fav.png" id="fav" data-fav-id="${nTab.id}" width="24" alt="">
                    <span>
                        New Tab
                    </span>
                <i class="fas fa-times close-btn"></i>
                `

            tabElement.addEventListener("click", (e) => {
                if (!e.target.closest(".close-btn")) {
                    switchTab(nTab.id)
                }
            })

            const closebtn = tabElement.querySelector(".close-btn")
            closebtn.addEventListener("click", (e) => {
                e.stopPropagation();
                closeTab(nTab.id);
                console.log("closed tab")
            });

            tabCont.insertBefore(tabElement, ntBtn)

            tabFrame = document.createElement("iframe")
            tabFrame.classList.add("viewframe", "browser-frame")
            tabFrame.dataset.frameId = nTab.id
            tabFrame.setAttribute("allowfullscreen", "true")
            tabFrame.src = "/newtab.html"

            document.body.appendChild(tabFrame)

            switchTab(nTab.id)
        }

        function switchTab(tId) {
            aTab = tId

            document.querySelectorAll(".tab").forEach(tab => {
                tab.classList.toggle("active", parseInt(tab.dataset.tabId) === tId)
            })

            document.querySelectorAll(".viewframe").forEach(frame => {
                frame.classList.toggle("active", parseInt(frame.dataset.frameId) === tId)
            })

            const cTab = bTabs.find(t => t.id === tId)
            if (cTab) {
                const input = document.getElementById("searchbar")
                if (input) input.value = cTab.url
            }
        }


        function closeTab(tId) {
            if (bTabs.length === 1) {
                showToast("error", "Cannot close last tab!", "fas fa-circle-xmark")
                return
            }

            const tIndex = bTabs.findIndex((t) => t.id === tId)
            if (tIndex === -1) return

            bTabs.splice(tIndex, 1)

            const tEl = document.querySelector(`.tab[data-tab-id="${tId}"]`)
            const frame = document.querySelector(`.viewframe[data-frame-id="${tId}"]`)

            if (tEl) tEl.remove()
            if (frame) frame.remove()

            if (aTab === tId) {
                const newATab = bTabs[Math.max(0, tIndex - 1)];
                if (newATab) {
                    switchTab(newATab.id);
                    console.log("woah")
                }
            }
        }

        function nav(i) {
            console.log("e")
            if (!i.trim()) return

            let url = i.trim()

            if (!url.includes(".") || url.includes(" ")) {
                url = searchE + encodeURIComponent(url)
            } else {
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url
                }
            }

            const cTab = bTabs.find((t) => t.id === aTab)
            if (!cTab) return

            cTab.history.push(url)
            cTab.historyIndex++

            cTab.url = url

            if (localStorage.getItem("cherri_backend") === "Scramjet" || localStorage.getItem("cherri_backend") === "scramjet" || !localStorage.getItem("cherri_backend")) {
                fUrl = scramjet.encodeUrl(url)
            } else if (localStorage.getItem("cherri_backend") === "Ultraviolet") {
                fUrl = "/uv/service/" + __uv$config.encodeUrl(url)
            } else {
                fUrl = scramjet.encodeUrl(url)
            }

            go(fUrl)
        }

        function updateUrlFromIframe(viewframe) {
            try {
                const cTab = bTabs.find((t) => t.id === aTab)
                if (!cTab) return

                let decodedUrl
                const currentSrc = viewframe.src

                if (localStorage.getItem("cherri_backend") === "Ultraviolet") {
                    if (currentSrc.includes("/uv/service/")) {
                        decodedUrl = __uv$config.decodeUrl(currentSrc.split("/uv/service/")[1])
                    }
                } else {
                    decodedUrl = scramjet.decodeUrl(currentSrc)
                }

                if (decodedUrl && decodedUrl !== cTab.url) {
                    cTab.url = decodedUrl

                    const ubar = document.getElementById("searchbar")
                    if (ubar) ubar.value = decodedUrl

                    const favEl = document.querySelector(`#fav[data-fav-id="${aTab}"]`)
                    if (favEl) favEl.src = `https://www.google.com/s2/favicons?domain=${decodedUrl}&sz=256`
                }
            } catch (e) {
                console.error("Error updating URL from iframe:", e)
            }
        }

        async function go(u) {
            if (!await connection.getTransport()) {
                connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }])
            }

            console.log("a")
            const cTab = bTabs.find((t) => t.id === aTab)
            const favEl = document.querySelector(`#fav[data-fav-id="${aTab}"]`)
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            if (!viewframe) return

            const ubar = document.getElementById("searchbar")

            const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
            if (tabEl) {
                const titleEl = tabEl.querySelector("span")
                if (titleEl) titleEl.textContent = "Loading..."
            }

            if (ubar) ubar.value = cTab.url
            const favUrl = cTab.url
            if (favEl) favEl.src = `https://www.google.com/s2/favicons?domain=${favUrl}&sz=256`

            try {
                viewframe.src = u
                console.log("ooooo")

                viewframe.onload = () => {
                    try {
                        const iframeDoc = viewframe.contentDocument || viewframe.contentWindow.document
                        const title = iframeDoc.title || new URL(cTab.url).hostname

                        const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
                        if (tabEl) {
                            const titleEl = tabEl.querySelector("span")
                            if (titleEl) titleEl.textContent = title
                        }

                        updateUrlFromIframe(viewframe)
                    } catch (e) {
                        console.error("Error accessing iframe content:", e)
                        const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
                        if (tabEl) {
                            const titleEl = tabEl.querySelector("span")
                            if (titleEl) titleEl.textContent = new URL(cTab.url).hostname
                        }

                        updateUrlFromIframe(viewframe)
                    }
                }
            } catch (e) {
                console.error("There was an error while loading the page:", e)
                showToast("error", "There was a problem loading the page. Check the console for more info.", "fas fa-times-circle")
            }
        }

        function b() {
            const cTab = bTabs.find((t) => t.id === aTab)
            if (!cTab || cTab.historyIndex <= 0) return;

            cTab.historyIndex--
            const u = cTab.history[cTab.historyIndex]
            cTab.url = u
            let furl
            const ba = localStorage.getItem("cherri_backend")
            if (ba.toLowerCase() === "scramjet") {
                furl = scramjet.encodeUrl(u)
            } else if (ba.toLowerCase() === "ultraviolet") {
                furl = __uv$config.prefix + __uv$config.encodeUrl(u)
            } else {
                furl = scramjet.encodeUrl(u)
            }

            go(furl)
        }

        function f() {
            const cTab = bTabs.find((t) => t.id === aTab)

            cTab.historyIndex++
            const u = cTab.history[cTab.historyIndex]
            cTab.url = u
            let furl
            const ba = localStorage.getItem("cherri_backend")
            if (ba.toLowerCase() === "scramjet") {
                furl = scramjet.encodeUrl(u)
            } else if (ba.toLowerCase() === "ultraviolet") {
                furl = __uv$config.prefix + __uv$config.encodeUrl(u)
            } else {
                furl = scramjet.encodeUrl(u)
            }

            go(furl)
        }

        function r() {
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            const curl = viewframe.src

            viewframe.src = curl
        }

        function full() {
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            viewframe.requestFullscreen()
            console.log("sdfkjhasdkjhfg")
        }

        function hideBrowser() {
            const b = document.querySelector(".browser-container")
            const frames = document.querySelectorAll(".viewframe")
            b.style.opacity = 0
            frames.forEach(frame => {
                frame.style.opacity = 0
                frame.style.pointerEvents = "none"
            })
            b.style.pointerEvents = "none"
        }

        async function launchEruda() {
            showToast("info", "Launching Eruda...", "fas fa-info-circle")
            try {
                eruda.init();
                showToast("success", "Successfully injected Eruda", "fa-solid fa-check-circle")
            } catch (e) {
                showToast("error", "Failed to inject Eruda", "fas fa-times-circle")
            }
        }

    </script>
    <script defer>
        window.addEventListener("DOMContentLoaded", () => {
            console.log("cherri: dom content loaded")
            const homesearch = document.getElementById("homesearch");

            homesearch.addEventListener("keydown", (e) => {
                console.log("askjdfaskhjlgdf")
                if (e.key === "Enter") {
                    rSearch(homesearch?.value.trim());
                    console.log("rsearching")
                }
                console.log("check")
            });
        })
    </script>
</body>