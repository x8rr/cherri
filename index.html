<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/svg+xml" href="/assets/fav.png">
    <title>breeze.</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/uv/uv.bundle.js"></script>
    <script src="/uv/uv.config.js"></script>
    <script src="/baremux/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/assets/js/t.js" defer></script>
    <script src="/sj/scramjet.all.js"></script>
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/fa/css/all.css">
    <link rel="stylesheet" href="/fa/css/all.min.css">
    <link rel="stylesheet" href="/fa/css/solid.css">
    <link rel="stylesheet" href="/fa/css/all-pro.css">
    <link rel="stylesheet" href="/assets/css/t.css">
    <link rel="stylesheet" href="/assets/css/dropdown.css">
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script src="/assets/js/splash.js" defer></script>
</head>

<body>
    <div class="grid"></div>
    <nav>
        <ul>
            <li style="width: 120px;">
                <a onclick="navTo('home')" style="margin-top: 50%; margin-left: 40%; transform: translate(-50%, -178%);"
                    href="#" data-page="home">
                    <div class="hcontainer">
                        <img src="/assets/fav.png" style="height: 32px; margin-top: -4px;" alt="">
                        <p>breeze.</p>
                    </div>
                </a>
            </li>
            <li class="disabled">
                <a onclick="navTo('games')" href="#" data-page="games">
                    <i class="fas fa-gamepad"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('apps')" href="#" data-page="apps">
                    <i class="fas fa-grid"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('movies')" href="#" data-page="movies">
                    <i class="fas fa-clapperboard"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('social')" href="#" data-page="social">
                    <i class="fas fa-users"></i>
                </a>
            </li>
            <li class="toright">
                <a onclick="toggleSettings()" href="#" data-page="settings">
                    <i class="fas fa-cog"></i>
                </a>
            </li>
        </ul>
    </nav>
    <div id="homeContent">
        <h1 class="text-7xl font-medium"
            style="background: linear-gradient(to bottom right, white 20%, rgb(56, 56, 56)); background-clip: text; color: transparent;">
            breeze.</h1>
        <p id="splash" class="text-medium font-light text-white/50">
            wsp
        </p>
        <br>
        <div class="searchathome">
            <i class="fas fa-search"></i>
            <input id="homesearch" style="margin-right: -3%;" type="text" placeholder="search anything..." />
        </div>
        <br><br>
    </div>

    <div class="toast-container fixed right-4 top-4 w-1/4">
    </div>

    <div class="toast-container"></div>

    <iframe id="contentFrame"></iframe>

    <div class="settings-container settings-hidden">
        <div class="container">
            <div class="settings-sidebar vflex">
                <div class="settings-section" style="background: #1d1d1d;" onclick="switchSettingsPage('general')"
                    data-target="general">
                    <i class="fas fa-cog"></i>
                    General
                </div>
                <div class="settings-section" onclick="switchSettingsPage('cloaking')" data-target="cloaks">
                    <i class="far fa-hood-cloak"></i>
                    Cloaking
                </div>
                <div class="settings-section" onclick="switchSettingsPage('proxy')" data-target="proxy">
                    <i class="fas fa-browser"></i>
                    Proxy
                </div>
                <div class="settings-section" onclick="switchSettingsPage('info')" data-target="info">
                    <i class="far fa-file"></i>
                    Info
                </div>
            </div>

            <div class="settings-content-container">
                <div id="settings-general" class="settings-active settings-page">
                    <h2>Search Engine</h2>
                    <p>This is the search engine that the proxy will use with search queries.</p>
                    <div class="search-engine-selector">
                        <div class="search-engine-selected"></div>
                        <div class="search-engine-options">

                        </div>
                    </div>
                </div>

                <div id="settings-cloaking" class="settings-page">
                    <h2>Tab Cloak</h2>
                    <p>How your tab will appear in history, on filtering extensions, and more.</p>
                    <div class="decoy-selector">
                        <div class="decoy-selected"></div>
                        <div class="decoy-options">

                        </div>
                    </div>
                </div>

                <div id="settings-proxy" class="settings-page">
                    <h2>Wisp Server</h2>
                    <p>The server that all content will be transferred through. Make sure the Wisp server you are using
                        is not blocked, or the proxy will not function.</p>
                    <div class="wisp-selector">
                        <div class="wisp-selected"></div>
                        <div class="wisp-options">

                        </div>
                    </div>
                    <h2>Backend</h2>
                    <p>The main proxy service. Scramjet is newer but more experimental, while Ultraviolet is older but
                        less advanced.</p>
                    <div class="backend-selector">
                        <div class="backend-selected"></div>
                        <div class="backend-options">

                        </div>
                    </div>
                </div>

                <div id="settings-info" class="settings-page">
                    <h2>Credits</h2>
                    <p>
                        <b>GN Math</b> - all games <br>
                        <b><a href="https://waves.lat" target="_blank">Waves</a></b> - custom dropdown, styling
                        inspiration <br>
                        <b>TitaniumNetwork</b> - Ultraviolet <br>
                        <b>Scramjet</b> - Libcurl and Scramjet <br>
                        <b><a href="https://github.com/ambr0sial/nova" target="_blank">Nova</a></b> - movies and TV
                        source <br>
                        <b>RHW, Terbium, and Anura</b> - Wisp servers <br>
                    </p>

                    <br>

                    <h2>Thank you!</h2>
                    <p>Thanks for using breeze! We hope you enjoyed your stay, and maybe star us on the <a
                            href="https://github.com/x8rr/breeze" target="_blank">repository.</a></p>
                </div>
            </div>

            <p class="absolute bottom-4 text-[#3d3d3d] font-medium text-sm">breeze <span
                    class="opacity-50 bg-[#4d4d4d] p-1 rounded-lg text-black"><a
                        href="https://github.com/x8rr/breeze/releases" target="_blank" class="text-black"
                        style="text-decoration: none;">v0.0.1 beta 3</a></span></p>
        </div>
    </div>

    <div class="browser-container">
        <div class="browser-controls">
            <div class="tabs">
                <button class="newtab" onclick="newTab()">
                    <i class="far fa-plus"></i>
                </button>
            </div>
            <div class="browser-buttons">
                <div class="hcontainer">
                    <button onclick="b()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button onclick="f()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button onclick="r()">
                        <i class="fas fa-rotate-right"></i>
                    </button>
                    <input type="text" id="searchbar" placeholder="search anything...">
                    <button onclick="full()">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button onclick="eruda.init()">
                        <i class="fas fa-code-simple"></i>
                    </button>
                    <button onclick="hideBrowser()">
                        <i class="fas fa-house"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/js/dropdown.js"></script>

    <script>
        let aTab = 0
        let tabCounter = 1
        let bTabs = [
            {
                id: 0,
                title: "New Tab",
                url: "",
                history: [],
                historyIndex: -1,
            },
        ]
        const tabCont = document.querySelector(".tabs")
        let tabFrame
        let fUrl
        const inp = document.getElementById("searchbar")
    </script>
    <script>

        inp.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                nav(inp.value)
                console.log("i")
            }
        })
    </script>
    <script>
        const connection = new BareMux.BareMuxConnection("/baremux/worker.js")
        const wispUrl = localStorage.getItem("breeze_wispUrl") || "wss://wisp.rhw.one/"
        const bareUrl = "https://useclassplay.vercel.app/fq/"
    </script>
    <script>
        const CONFIG = {
            files: {
                wasm: "/sj/scramjet.wasm.wasm",
                all: "/sj/scramjet.all.js",
                sync: "/sj/scramjet.sync.js",
            }
        }

        const { ScramjetController } = $scramjetLoadController()
        const scramjet = new ScramjetController({
            files: CONFIG.files,
        })
        scramjet.init()


    </script>
    <script defer>
        window.addEventListener("load", () => {
            const frames = document.querySelectorAll(".viewframe")
            const activeFrames = document.querySelectorAll(".active")

            activeFrames.forEach(frame => {
                frame.classList.remove("active")
            })
        })
    </script>
    <script>
        let searchE

        const se = localStorage.getItem("breeze_searchEngine") || "DuckDuckGo"
        const bar = document.getElementById("urlbar")

        if (se === "DuckDuckGo") {
            searchE = "https://duckduckgo.com/search?q="
        } else if (se === "Bing") {
            searchE = "https://bing.com/search?q="
        } else if (se === "Google") {
            searchE = "https://google.com/search?q="
        } else if (se === "Startpage") {
            searchE = "https://startpage.com/search?q="
        } else if (se === "https://qwant.com/search?q=") {
            bar.placeholder = "Search with Qwant or enter a URL here"
        } else {
            bar.placeholder = "Search with Brave or enter a URL here"
        }
        connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }])

        function newTab() {
            const nTab = {
                id: tabCounter++,
                title: "New Tab",
                url: "",
                history: [],
                historyIndex: -1,
            };

            bTabs.push(nTab)
            if (!tabCont) return

            const ntBtn = document.querySelector('.newtab')

            const tabElement = document.createElement("div")
            tabElement.classList.add("tab", "hcontainer")
            tabElement.dataset.tabId = nTab.id
            tabElement.innerHTML = `
                <img src="/assets/fav.png" id="fav" data-fav-id="${nTab.id}" width="24" alt="">
                    <span>
                        New Tab
                    </span>
                <i class="fas fa-times close-btn"></i>
                `

            tabElement.addEventListener("click", (e) => {
                if (!e.target.closest(".close-btn")) {
                    switchTab(nTab.id)
                }
            })

            const closebtn = tabElement.querySelector(".close-btn")
            closebtn.addEventListener("click", (e) => {
                e.stopPropagation();
                closeTab(nTab.id);
                console.log("closed tab")
            });

            tabCont.insertBefore(tabElement, ntBtn)

            tabFrame = document.createElement("iframe")
            tabFrame.classList.add("viewframe", "browser-frame")
            tabFrame.dataset.frameId = nTab.id
            tabFrame.setAttribute("allowfullscreen", "true")
            tabFrame.src = "/newtab.html"

            document.body.appendChild(tabFrame)

            switchTab(nTab.id)
        }

        function switchTab(tId) {
            aTab = tId

            document.querySelectorAll(".tab").forEach(tab => {
                tab.classList.toggle("active", parseInt(tab.dataset.tabId) === tId)
            })

            document.querySelectorAll(".viewframe").forEach(frame => {
                frame.classList.toggle("active", parseInt(frame.dataset.frameId) === tId)
            })

            const cTab = bTabs.find(t => t.id === tId)
            if (cTab) {
                const input = document.getElementById("searchbar")
                if (input) input.value = cTab.url
            }
        }


        function closeTab(tId) {
            if (bTabs.length === 1) {
                showToast("error", "Cannot close last tab!", "fas fa-circle-xmark")
                return
            }

            const tIndex = bTabs.findIndex((t) => t.id === tId)
            if (tIndex === -1) return

            bTabs.splice(tIndex, 1)

            const tEl = document.querySelector(`.tab[data-tab-id="${tId}"]`)
            const frame = document.querySelector(`.viewframe[data-frame-id="${tId}"]`)

            if (tEl) tEl.remove()
            if (frame) frame.remove()

            if (aTab === tId) {
                const newATab = bTabs[Math.max(0, tIndex - 1)];
                if (newATab) {
                    switchTab(newATab.id);
                    console.log("woah")
                }
            }
        }

        function nav(i) {
            console.log("e")
            if (!i.trim()) return

            let url = i.trim()

            if (!url.includes(".") || url.includes(" ")) {
                url = searchE + encodeURIComponent(url)
            } else {
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url
                }
            }

            const cTab = bTabs.find((t) => t.id === aTab)
            if (!cTab) return

            cTab.history.push(url)
            cTab.historyIndex++

            cTab.url = url

            if (localStorage.getItem("breeze_backend") === "Scramjet" || localStorage.getItem("breeze_backend") === "scramjet" || !localStorage.getItem("breeze_backend")) {
                fUrl = scramjet.encodeUrl(url)
            } else if (localStorage.getItem("breeze_backend") === "Ultraviolet") {
                fUrl = "/uv/service/" + __uv$config.encodeUrl(url)
            } else {
                fUrl = scramjet.encodeUrl(url)
            }

            go(fUrl)
        }

        function updateUrlFromIframe(viewframe) {
            try {
                const cTab = bTabs.find((t) => t.id === aTab)
                if (!cTab) return

                let decodedUrl
                const currentSrc = viewframe.src

                if (localStorage.getItem("breeze_backend") === "Ultraviolet") {
                    if (currentSrc.includes("/uv/service/")) {
                        decodedUrl = __uv$config.decodeUrl(currentSrc.split("/uv/service/")[1])
                    }
                } else {
                    decodedUrl = scramjet.decodeUrl(currentSrc)
                }

                if (decodedUrl && decodedUrl !== cTab.url) {
                    cTab.url = decodedUrl
                    
                    const ubar = document.getElementById("searchbar")
                    if (ubar) ubar.value = decodedUrl

                    const favEl = document.querySelector(`#fav[data-fav-id="${aTab}"]`)
                    if (favEl) favEl.src = `https://www.google.com/s2/favicons?domain=${decodedUrl}&sz=256`
                }
            } catch (e) {
                console.error("Error updating URL from iframe:", e)
            }
        }

        async function go(u) {
            if (!await connection.getTransport()) {
                connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }])
            }

            console.log("a")
            const cTab = bTabs.find((t) => t.id === aTab)
            const favEl = document.querySelector(`#fav[data-fav-id="${aTab}"]`)
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            if (!viewframe) return

            const ubar = document.getElementById("searchbar")

            const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
            if (tabEl) {
                const titleEl = tabEl.querySelector("span")
                if (titleEl) titleEl.textContent = "Loading..."
            }

            if (ubar) ubar.value = cTab.url
            const favUrl = cTab.url
            if (favEl) favEl.src = `https://www.google.com/s2/favicons?domain=${favUrl}&sz=256`

            try {
                viewframe.src = u
                console.log("ooooo")

                viewframe.onload = () => {
                    try {
                        const iframeDoc = viewframe.contentDocument || viewframe.contentWindow.document
                        const title = iframeDoc.title || new URL(cTab.url).hostname

                        const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
                        if (tabEl) {
                            const titleEl = tabEl.querySelector("span")
                            if (titleEl) titleEl.textContent = title
                        }

                        updateUrlFromIframe(viewframe)
                    } catch (e) {
                        console.error("Error accessing iframe content:", e)
                        const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
                        if (tabEl) {
                            const titleEl = tabEl.querySelector("span")
                            if (titleEl) titleEl.textContent = new URL(cTab.url).hostname
                        }
                        
                        updateUrlFromIframe(viewframe)
                    }
                }
            } catch (e) {
                console.error("There was an error while loading the page:", e)
                alert("There was an error while loading the page: " + e)
            }
        }

        function b() {
            const cTab = bTabs.find((t) => t.id === aTab)
            if (!cTab || cTab.historyIndex <= 0) return;

            cTab.historyIndex--
            const u = cTab.history[cTab.historyIndex]
            cTab.url = u
            const furl = __uv$config.prefix + __uv$config.encodeUrl(u)

            go(furl)
        }

        function f() {
            const cTab = bTabs.find((t) => t.id === aTab)

            cTab.historyIndex++
            const u = cTab.history[cTab.historyIndex]
            cTab.url = u
            const furl = __uv$config.prefix + __uv$config.encodeUrl(u)

            go(furl)
        }

        function r() {
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            const curl = viewframe.src

            viewframe.src = curl
        }

        function full() {
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            viewframe.requestFullscreen()
            console.log("sdfkjhasdkjhfg")
        }

        function hideBrowser() {
            const b = document.querySelector(".browser-container")
            const frames = document.querySelectorAll(".viewframe")
            b.style.opacity = 0
            frames.forEach(frame => {
                frame.style.opacity = 0
                frame.style.pointerEvents = "none"
            })
            b.style.pointerEvents = "none"
        }

        setInterval(() => {
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            if (viewframe && viewframe.src) {
                updateUrlFromIframe(viewframe)
            }
        }, 1000)
    </script>

    <script>
        const settingsHolder = document.querySelector(".settings-container")
        const settingsViewframe = document.querySelector(".settings-content-container")

        const general = document.querySelector("#settings-general")
        const cloaking = document.querySelector("#settings-cloaking")
        const proxy = document.querySelector("#settings-proxy")
        const cookes = document.querySelector("#settings-cookies")
        const info = document.querySelector("#settings-info")

        const allPages = document.querySelectorAll(".settings-page")
        const allButtons = document.querySelectorAll(".settings-section")

        function switchSettingsPage(target) {
            allPages.forEach(page => {
                page?.classList.remove("settings-active")
                document.querySelector(`#settings-${target}`)?.classList.add("settings-active")
            })
        }

        allButtons.forEach(button => {
            button.addEventListener("click", () => {
                allButtons.forEach(btn => {
                    btn.style.background = ""
                    button.style.background = "#1d1d1d"
                })
            })
        })

        function toggleSettings() {
            if (settingsHolder.classList.contains("settings-hidden")) {
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                settingsHolder.classList.remove("settings-hidden")
                settingsHolder.classList.add("settings-shown")
            } else {
                settingsHolder.classList.remove("settings-shown")
                settingsHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }
    </script>
    <script>
        newTab()
    </script>
    <script>
        async function registerSW() {
            if ("serviceWorker" in navigator) {
                await navigator.serviceWorker.register("/uv/sw.js").then(() => {
                    console.log(
                        "%cbreeze." + "%c UV sw registered!",
                        "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                        "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                    );
                    setTimeout(() => {
                        showToast("success", "Ultraviolet worker initialized!", "fas fa-check-circle")
                        console.log("shown toast")
                    }, 1000)
                }).catch(e => {
                    console.log("Error registering service worker (UV): " + e)
                    showToast("error", "Failed to register service worker", "fas fa-times-circle")
                });

                await navigator.serviceWorker.register("/sw.js").then(() => {
                    console.log(
                        "%cbreeze." + "%c SJ sw registered!",
                        "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                        "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                    );
                    setTimeout(() => {
                        showToast("success", "Scramjet worker initialized", "fas fa-check-circle")
                        console.log("shown toast")
                    }, 1000)
                }).catch(e => {
                    console.log("Error registering service worker (SJ): " + e)
                    showToast("error", "Failed to register service worker", "fas fa-times-circle")
                });
            }
        }

        window.addEventListener("load", () => {
            registerSW();
            lucide.createIcons();
        });

        const contentFrame = document.getElementById('contentFrame');
        const homeContent = document.getElementById('homeContent');
        const navLinks = document.querySelectorAll('nav a[data-page]');

        function navTo(l) {
            if (l === "home") {
                contentFrame.style.display = "none"
                homeContent.style.display = "block"
            } else {
                homeContent.style.display = "none"
                contentFrame.style.display = "block"
                contentFrame.src = `/pages/${l}.html`
            }
        }

        const homesearch = document.getElementById("homesearch");

        function rSearch(input) {
            let url = input;
            if (!url.includes(".") || url.includes(" ")) {
                url = "https://search.brave.com/search?q=" + url;
            } else {
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url;
                }
            }

            const b = document.querySelector(".browser-container")
            const frames = document.querySelectorAll(".viewframe")

            b.style.opacity = 1
            b.style.pointerEvents = "all"

            frames.forEach(frame => {
                frame.style.opacity = 1
                frame.style.pointerEvents = "all"
            })

            nav(url)
            switchTab(aTab)
        }

        homesearch?.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                rSearch(homesearch?.value.trim());
            }
        });

        function toast(icon, msg) {
            const container = document.querySelector(".toast-container")
            const newToast = document.createElement("div")
            const newToastIcon = document.createElement("i")
            newToastIcon.classList.add("toast-icon", "lucide", "fas", "fa-icon-lol")
            const newToastMsg = document.createElement("span")
            newToastMsg.classList.add("toast-msg")
            newToast.classList.add("toast", "bg-slate-900", "transition-all", "relative", "duration-300", "shadow-black/30", "shadow-lg", "p-4", "h-fit", "w-1/1", "flex", "rounded-full", "m-3", "border", "border-white/10")
            newToast.style.right = "-120%"
            container.appendChild(newToast)
            newToast.appendChild(newToastIcon)
            newToast.appendChild(newToastMsg)

            switch (icon) {
                case "success":
                    if (newToastIcon && newToastMsg) {
                        newToastIcon.classList.add("fa-circle-check")
                        newToastMsg.textContent = msg
                    }
                    break
                case "info":
                    newToastIcon.classList.add("fa-circle-info")
                    newToastMsg.textContent = msg
                    break;
                case "error":
                    newToastIcon.classList.add("fa-circle-xmark")
                    newToastMsg.textContent = msg
                case "warn":
                    newToastIcon.classList.add("fa-warning")
                    newToastMsg.textContent = msg
                case "log":
                    newToastIcon.classList.add("fa-memo-circle-info")
                    newToastMsg.textContent = msg
            }

            setTimeout(() => {
                newToast.style.right = "4%"
            }, 25)

            setTimeout(() => {
                newToast.style.right = "-120%"
            }, 4000)

            setTimeout(() => {
                newToast.remove()
            }, 4325)
        }
    </script>
</body>

</html>