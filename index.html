<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/svg+xml" href="/assets/fav.png">
    <title>breeze.</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/uv/uv.bundle.js"></script>
    <script src="/uv/uv.config.js"></script>
    <script src="/baremux/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/assets/js/t.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@widgetbot/html-embed"></script>
    <script src="/sj/scramjet.all.js"></script>
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/fa/css/all.css">
    <link rel="stylesheet" href="/fa/css/all.min.css">
    <link rel="stylesheet" href="/fa/css/solid.css">
    <link rel="stylesheet" href="/fa/css/all-pro.css">
    <link rel="stylesheet" href="/assets/css/t.css">
    <link rel="stylesheet" href="/assets/css/dropdown.css">
    <script src="https://cdn.jsdelivr.net/npm/eruda@3.4.3/eruda.min.js"></script>
    <script src="/assets/js/splash.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const { createClient } = supabase

        window.supabase = createClient(
            "https://cijvekrvveajsspihuih.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpanZla3J2dmVhanNzcGlodWloIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMjQxNzYsImV4cCI6MjA3ODkwMDE3Nn0.S45f8BH8EGrsZL8zQb-qxNXoVOSTwlhl9TtWEtrvQT0",
            {
                auth: {
                    autoRefreshToken: true,
                    persistSession: true,
                    detectSessionInUrl: true
                }
            }
        );

    </script>
    <script>
        async function signUp(u, p) {
            try {
                const { data, error } = await window.supabase.auth.signUp({
                    email: `${u}@breezeaccounts.lol`,
                    password: p,
                });
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Sign up error:', error);
                throw error;
            }
        }

        async function signIn(u, p) {
            try {
                const { data, error } = await window.supabase.auth.signInWithPassword({
                    email: `${u}@breezeaccounts.lol`,
                    password: p,
                });
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Sign in error:', error);
                throw error;
            }
        }

        async function signOut() {
            try {
                const { error } = await window.supabase.auth.signOut();
                if (error) throw error;
            } catch (error) {
                console.error('Sign out error:', error);
                throw error;
            }
        }

        async function getUser() {
            try {
                const { data: { session }, error } = await window.supabase.auth.getSession();
                if (error) throw error;
                return session?.user || null;
            } catch (error) {
                console.error('Get user error:', error);
                return null;
            }
        }
    </script>
    <script>
        newTab()
    </script>
    <script>


        function toast(icon, msg) {
            const container = document.querySelector(".toast-container")
            const newToast = document.createElement("div")
            const newToastIcon = document.createElement("i")
            newToastIcon.classList.add("toast-icon", "lucide", "fas", "fa-icon-lol")
            const newToastMsg = document.createElement("span")
            newToastMsg.classList.add("toast-msg")
            newToast.classList.add("toast", "bg-slate-900", "transition-all", "relative", "duration-300", "shadow-black/30", "shadow-lg", "p-4", "h-fit", "w-1/1", "flex", "rounded-full", "m-3", "border", "border-white/10")
            newToast.style.right = "-120%"
            container.appendChild(newToast)
            newToast.appendChild(newToastIcon)
            newToast.appendChild(newToastMsg)

            switch (icon) {
                case "success":
                    if (newToastIcon && newToastMsg) {
                        newToastIcon.classList.add("fa-circle-check")
                        newToastMsg.textContent = msg
                    }
                    break
                case "info":
                    newToastIcon.classList.add("fa-circle-info")
                    newToastMsg.textContent = msg
                    break;
                case "error":
                    newToastIcon.classList.add("fa-circle-xmark")
                    newToastMsg.textContent = msg
                case "warn":
                    newToastIcon.classList.add("fa-warning")
                    newToastMsg.textContent = msg
                case "log":
                    newToastIcon.classList.add("fa-memo-circle-info")
                    newToastMsg.textContent = msg
            }

            setTimeout(() => {
                newToast.style.right = "4%"
            }, 25)

            setTimeout(() => {
                newToast.style.right = "-120%"
            }, 4000)

            setTimeout(() => {
                newToast.remove()
            }, 4325)
        }

        function showToast(type, message, icon) {
            toast(type, message)
        }
    </script>

    <script>
        let authMode = "signin";

        async function checkAuth() {
            try {
                const user = await getUser();
                if (user) {
                    document.querySelector("#auth-section i").classList.replace("fa-user", "fa-user-check");
                    document.getElementById("signout-btn").style.display = "block";

                    const authBtn = document.querySelector("#auth-section a");
                    authBtn.setAttribute("onclick", "toggleDashboard()");

                    showToast("success", `Logged in as ${user.email.split("@")[0]}`, "fas fa-check-circle");
                }
            } catch (error) {
                console.error('Auth check error:', error);
            }
        }

        function toggleAuth() {
            const authHolder = document.querySelector(".auth-container");
            if (authHolder.classList.contains("settings-hidden")) {
                if (document.querySelector(".apps-wrapper").classList.contains("settings-shown")) {
                    toggleApps();
                }
                if (document.querySelector(".settings-container").classList.contains("settings-shown")) {
                    toggleSettings();
                }
                const newBlurOverlay = document.createElement("div");
                newBlurOverlay.classList.add("blurOverlay");
                document.body.appendChild(newBlurOverlay);
                authHolder.classList.remove("settings-hidden");
                authHolder.classList.add("settings-shown");
            } else {
                authHolder.classList.remove("settings-shown");
                authHolder.classList.add("settings-hidden");
                document.querySelector(".blurOverlay")?.remove();
            }
        }

        function toggleAuthMode() {
            authMode = authMode === "signin" ? "signup" : "signin";
            document.getElementById("auth-title").textContent = authMode === "signin" ? "Sign In" : "Sign Up";
            document.getElementById("auth-toggle").textContent = authMode === "signin" ? "Need an account? Sign up" : "Have an account? Sign in";
        }

        async function handleAuth() {
            const username = document.getElementById("auth-username").value;
            const password = document.getElementById("auth-password").value;

            if (!username || !password) {
                showToast("error", "Please fill in all fields", "fas fa-times-circle");
                return;
            }

            try {
                if (authMode === "signup") {
                    await signUp(username, password);
                    showToast("success", "Account created! Please sign in.", "fas fa-check-circle");
                    toggleAuthMode();
                } else {
                    await signIn(username, password);
                    showToast("success", "Logged in!", "fas fa-check-circle");
                    toggleAuth();
                    await checkAuth();
                    document.getElementById("auth-username").value = "";
                    document.getElementById("auth-password").value = "";
                }
            } catch (e) {
                if (e.message.includes('fetch')) {
                    showToast("error", "Network error. Check your connection.", "fas fa-times-circle");
                } else {
                    showToast("error", e.message, "fas fa-times-circle");
                }
            }
        }

        async function handleSignOut() {
            try {
                await signOut();
                showToast("success", "Signed out. Reloading...", "fas fa-check-circle");
                document.querySelector("#auth-section i").classList.replace("fa-user-check", "fa-user");
                document.getElementById("signout-btn").style.display = "none";

                const authBtn = document.querySelector("#auth-section a");
                authBtn.setAttribute("onclick", "toggleAuth()");

                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } catch (error) {
                showToast("error", "Sign out failed", "fas fa-times-circle");
            }
        }

        window.addEventListener("load", async () => {
            await new Promise(resolve => setTimeout(resolve, 500));
            await checkAuth();
        });

        window.supabase.auth.onAuthStateChange((event, session) => {
            console.log('Auth state changed:', event, session);
            if (event === 'SIGNED_IN') {
                checkAuth();
            }
        });
    </script>
    </body>

</html>
</head>

<body>
    <div class="grid"></div>
    <nav>
        <ul>
            <li style="width: 120px;">
                <a onclick="navTo('home')" style="margin-top: 48%; margin-left: 40%; transform: translate(-50%, -178%);"
                    href="#" data-page="home">
                    <div class="hcontainer">
                        <img src="/assets/fav.png" style="height: 32px; margin-top: -4px;" alt="">
                        <p>breeze.</p>
                    </div>
                </a>
            </li>
            <li class="disabled">
                <a onclick="navTo('games')" href="#" data-page="games">
                    <i class="fas fa-gamepad"></i>
                </a>
            </li>
            <li>
                <a onclick="toggleApps()" href="#" data-page="apps">
                    <i class="fas fa-grid"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('movies')" href="#" data-page="movies">
                    <i class="fas fa-clapperboard"></i>
                </a>
            </li>
            <li>
                <a onclick="toggleChat()" href="#" data-page="social">
                    <i class="fas fa-messages"></i>
                </a>
            </li>
            <li class="toright" style="margin-right: 60px;" id="auth-section">
                <a onclick="toggleAuth()" href="#" data-page="auth">
                    <i class="fas fa-user"></i>
                </a>
            </li>
            <li class="toright">
                <a onclick="toggleSettings()" href="#" data-page="settings">
                    <i class="fas fa-cog"></i>
                </a>
            </li>
        </ul>
    </nav>
    <div id="homeContent">
        <h1 class="text-7xl font-medium"
            style="background: linear-gradient(to bottom right, white 20%, rgb(56, 56, 56)); background-clip: text; color: transparent;">
            breeze.</h1>
        <p id="splash" class="text-medium font-light text-white/50">
            wsp
        </p>
        <br>
        <div class="searchathome">
            <i class="fas fa-search"></i>
            <input id="homesearch" autocomplete="off" style="margin-right: -3%;" type="text"
                placeholder="search anything..." />
        </div>
        <br><br>
    </div>

    <div class="toast-container fixed right-4 top-4 w-1/4">
    </div>

    <div class="toast-container"></div>

    <iframe id="contentFrame"></iframe>

    <div class="auth-container settings-hidden">
        <div class="container">
            <h2 id="auth-title">Sign In</h2>
            <input type="text" id="auth-username" placeholder="username" class="auth-input">
            <input type="password" id="auth-password" placeholder="password" class="auth-input">
            <button onclick="handleAuth()" class="auth-button">Submit</button>
            <p onclick="toggleAuthMode()" class="auth-toggle-text">
                <span id="auth-toggle">Need an account? Sign up</span>
            </p>
            <p>There is a bug where a new account will break after 1-2 hours. We are actively trying to fix the bug.</p>
            <button onclick="handleSignOut()" id="signout-btn" class="auth-button signout-button">Sign Out</button>
        </div>
    </div>

    <div class="settings-container settings-hidden">
        <div class="container">
            <div class="settings-sidebar vflex">
                <div class="settings-section" style="background: #1d1d1d;" onclick="switchSettingsPage('general')"
                    data-target="general">
                    <i class="fas fa-cog"></i>
                    General
                </div>
                <div class="settings-section" onclick="switchSettingsPage('cloaking')" data-target="cloaks">
                    <i class="far fa-hood-cloak"></i>
                    Cloaking
                </div>
                <div class="settings-section" onclick="switchSettingsPage('proxy')" data-target="proxy">
                    <i class="fas fa-browser"></i>
                    Proxy
                </div>
                <div class="settings-section" onclick="switchSettingsPage('info')" data-target="info">
                    <i class="far fa-file"></i>
                    Info
                </div>
            </div>

            <div class="settings-content-container">
                <div id="settings-general" class="settings-active settings-page">
                    <h2>Search Engine</h2>
                    <p>This is the search engine that the proxy will use with search queries.</p>
                    <div class="search-engine-selector">
                        <div class="search-engine-selected"></div>
                        <div class="search-engine-options">

                        </div>
                    </div>
                </div>

                <div id="settings-cloaking" class="settings-page">
                    <h2>Tab Cloak</h2>
                    <p>How your tab will appear in history, on filtering extensions, and more.</p>
                    <div class="decoy-selector">
                        <div class="decoy-selected"></div>
                        <div class="decoy-options">

                        </div>
                    </div>
                </div>

                <div id="settings-proxy" class="settings-page">
                    <h2>Wisp Server</h2>
                    <p>The server that all content will be transferred through. Make sure the Wisp server you are using
                        is not blocked, or the proxy will not function.</p>
                    <div class="wisp-selector">
                        <div class="wisp-selected"></div>
                        <div class="wisp-options">

                        </div>
                    </div>
                    <h2>Backend</h2>
                    <p>The main proxy service. Scramjet is newer but more experimental, while Ultraviolet is older but
                        less advanced.</p>
                    <div class="backend-selector">
                        <div class="backend-selected"></div>
                        <div class="backend-options">

                        </div>
                    </div>
                </div>

                <div id="settings-info" class="settings-page">
                    <h2>Credits</h2>
                    <p>
                        <b>GN Math</b> - all games <br>
                        <b><a href="https://waves.lat" target="_blank">Waves</a></b> - custom dropdown, styling
                        inspiration <br>
                        <b>TitaniumNetwork</b> - Ultraviolet <br>
                        <b>Scramjet</b> - Libcurl and Scramjet <br>
                        <b><a href="https://github.com/ambr0sial/nova" target="_blank">Nova</a></b> - movies and TV
                        source <br>
                        <b>RHW, Terbium, and Anura</b> - Wisp servers <br>
                    </p>

                    <br>

                    <h2>Thank you!</h2>
                    <p>Thanks for using breeze! We hope you enjoyed your stay, and maybe star us on the <a
                            href="https://github.com/x8rr/breeze" target="_blank">repository.</a></p>
                </div>
            </div>

            <p class="absolute bottom-4 text-[#3d3d3d] font-medium text-sm">breeze <span
                    class="opacity-50 bg-[#4d4d4d] p-1 rounded-lg text-black"><a
                        href="https://github.com/x8rr/breeze/releases" target="_blank" class="text-black"
                        style="text-decoration: none;">v0.0.1 beta 4</a></span></p>
        </div>
    </div>

    <div class="browser-container">
        <div class="browser-controls">
            <div class="tabs">
                <button class="newtab" onclick="newTab()">
                    <i class="far fa-plus"></i>
                </button>
            </div>
            <div class="browser-buttons">
                <div class="hcontainer">
                    <button onclick="b()">
                        <i class="far fa-chevron-left"></i>
                    </button>
                    <button onclick="f()">
                        <i class="far fa-chevron-right"></i>
                    </button>
                    <button onclick="r()">
                        <i class="far fa-rotate-right"></i>
                    </button>
                    <input type="text" id="searchbar" placeholder="search anything...">
                    <button onclick="full()">
                        <i class="far fa-expand"></i>
                    </button>
                    <button onclick="launchEruda()">
                        <i class="far fa-square-code"></i>
                    </button>
                    <button onclick="hideBrowser()">
                        <i class="far fa-house"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="apps-wrapper settings-hidden">
        <input onkeyup="searchApps(this.value)" type="text" style="font-family: Arial;"
            placeholder="search through the apps..." id="apps-search"
            class="h-fit p-4 px-5 w-[475px] bg-[#0f0f0f] border-none absolute left-1/2 translate-x-[-50%] rounded-2xl transition-all focus:bg-[#1d1d1d] focus:outline-none ">
        <br><br><br>
        <div
            class="apps-container h-[83%] overflow-y-scroll w-[475px] flex flex-wrap w-7/8 absolute left-1/2 translate-x-[-50%] justify-center">
        </div>
    </div>

    <div class="chat-container settings-hidden">
        <widgetbot server="1439475183294611590" channel="1439475383865966652" width="595px" height="46.45vh"
            style="border-radius: 25px;"></widgetbot>
    </div>

    <div class="dashboard-container settings-hidden">
        <div class="dashboard-content">
            <div class="dashboard-header">
                <div class="profile-section">
                    <div class="pfp-wrapper">
                        <img id="dashboard-pfp" src="/assets/fav.png" alt="Profile Picture">
                        <button class="pfp-edit-btn" onclick="document.getElementById('pfp-upload').click()">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                    <div class="user-info">
                        <h1 id="dashboard-username">Username</h1>
                        <p id="dashboard-email">email@breezeacounts.lol</p>
                    </div>
                </div>
                <button class="close-dashboard" onclick="toggleDashboard()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="dashboard-stats">
                <div class="stat-card">
                    <i class="fas fa-clock"></i>
                    <div>
                        <h3 id="time-spent">0h 0m</h3>
                        <p>Time without grass</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-link"></i>
                    <div>
                        <h3 id="sites-visited">0</h3>
                        <p>Sites Visited</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar"></i>
                    <div>
                        <h3 id="account-age">0d</h3>
                        <p>Account Age</p>
                    </div>
                </div>
            </div>

            <div style="display: none;" class="dashboard-section">
                <h2>Recent Activity</h2>
                <div id="recent-activity" class="activity-list">
                    <p class="empty-state">Activity coming soon!</p>
                </div>
            </div>

            <div class="dashboard-section">
                <h2>Settings</h2>
                <div class="settings-list">
                    <div class="setting-item">
                        <div>
                            <h3>Display Name</h3>
                            <p>Change your display name</p>
                        </div>
                        <button onclick="changeUsername()">Edit</button>
                    </div>
                    <div class="setting-item">
                        <div>
                            <h3>Password</h3>
                            <p>Update your password</p>
                        </div>
                        <button onclick="changePassword()">Change</button>
                    </div>
                    <div class="setting-item account-danger">
                        <div>
                            <h3>Log out</h3>
                            <p>Sign out of your account. You can always log back in later</p>
                        </div>
                        <button onclick="handleSignOut()">Log Out</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="pfp-upload" accept="image/*" style="display: none;">

    <script src="/assets/js/dropdown.js"></script>

    <script>
        let res
        let data

        const aCont = document.querySelector(".apps-container")

        async function gj() {
            res = await fetch("/assets/json/apps.json");
            data = await res.json()
        }

        function load() {
            gj().then(() => {
                console.log(
                    "%cbreeze." + "%c recieved json data!",
                    "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                    "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                )
            }).then(() => {
                data.forEach(item => {
                    const newAppContainer = document.createElement("button")
                    const newImage = document.createElement("img")
                    const newTitle = document.createElement("h1")

                    newAppContainer.classList.add("app")
                    newAppContainer.setAttribute("onclick", `rSearch(${item.url})`)
                    newTitle.textContent = item.name
                    newImage.src = item.img

                    newAppContainer.appendChild(newImage)
                    newAppContainer.appendChild(newTitle)

                    aCont.appendChild(newAppContainer)
                })
            })
        }

        load()

        function searchApps(term) {
            const apps = document.querySelectorAll(".app")
            apps.forEach((app) => {
                if (!app.querySelector("h1").textContent.toLowerCase().includes(term.toLowerCase())) {
                    app.style.display = "none"
                } else {
                    app.style.display = "flex"
                }
            })
        }
    </script>
    <script>
        async function registerSW() {
            if ("serviceWorker" in navigator) {
                await navigator.serviceWorker.register("/uv/sw.js").then(() => {
                    console.log(
                        "%cbreeze." + "%c UV sw registered!",
                        "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                        "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                    );
                    setTimeout(() => {
                        showToast("success", "Ultraviolet worker initialized!", "fas fa-check-circle")
                        console.log("shown toast")
                    }, 1000)
                }).catch(e => {
                    console.log("Error registering service worker (UV): " + e)
                    showToast("error", "Failed to register service worker", "fas fa-times-circle")
                });

                await navigator.serviceWorker.register("/sw.js").then(() => {
                    console.log(
                        "%cbreeze." + "%c SJ sw registered!",
                        "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                        "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                    );
                    setTimeout(() => {
                        showToast("success", "Scramjet worker initialized", "fas fa-check-circle")
                        console.log("shown toast")
                    }, 1000)
                }).catch(e => {
                    console.log("Error registering service worker (SJ): " + e)
                    showToast("error", "Failed to register service worker", "fas fa-times-circle")
                });
            }
        }

        window.addEventListener("load", () => {
            registerSW();
            lucide.createIcons();
        });

        const contentFrame = document.getElementById('contentFrame');
        const homeContent = document.getElementById('homeContent');
        const navLinks = document.querySelectorAll('nav a[data-page]');

        function navTo(l) {
            if (l === "home") {
                contentFrame.style.display = "none"
                homeContent.style.display = "block"
            } else {
                homeContent.style.display = "none"
                contentFrame.style.display = "block"
                contentFrame.src = `/pages/${l}.html`
            }
        }
    </script>
    <script>
        let aTab = 0
        let tabCounter = 1
        let bTabs = [
            {
                id: 0,
                title: "New Tab",
                url: "",
                history: [],
                historyIndex: -1,
            },
        ]
        const tabCont = document.querySelector(".tabs")
        let tabFrame
        let fUrl
        const inp = document.getElementById("searchbar")
    </script>
    <script>

        inp.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                nav(inp.value)
                console.log("i")
            }
        })
    </script>
    <script>
        const connection = new BareMux.BareMuxConnection("/baremux/worker.js")
        const wispUrl = localStorage.getItem("breeze_wispUrl") || "wss://wisp.rhw.one/"
        const bareUrl = "https://useclassplay.vercel.app/fq/"
    </script>
    <script>
        const CONFIG = {
            files: {
                wasm: "/sj/scramjet.wasm.wasm",
                all: "/sj/scramjet.all.js",
                sync: "/sj/scramjet.sync.js",
            }
        }

        const { ScramjetController } = $scramjetLoadController()
        const scramjet = new ScramjetController({
            files: CONFIG.files,
        })
        scramjet.init()


    </script>
    <script defer>
        window.addEventListener("load", () => {
            const frames = document.querySelectorAll(".viewframe")
            const activeFrames = document.querySelectorAll(".active")

            activeFrames.forEach(frame => {
                frame.classList.remove("active")
            })
        })
    </script>
    <script defer>
        const settingsHolder = document.querySelector(".settings-container")
        const settingsViewframe = document.querySelector(".settings-content-container")

        const appsHolder = document.querySelector(".apps-wrapper")

        const chatHolder = document.querySelector(".chat-container")

        const general = document.querySelector("#settings-general")
        const cloaking = document.querySelector("#settings-cloaking")
        const proxy = document.querySelector("#settings-proxy")
        const cookes = document.querySelector("#settings-cookies")
        const info = document.querySelector("#settings-info")

        const allPages = document.querySelectorAll(".settings-page")
        const allButtons = document.querySelectorAll(".settings-section")

        function switchSettingsPage(target) {
            allPages.forEach(page => {
                page?.classList.remove("settings-active")
                document.querySelector(`#settings-${target}`)?.classList.add("settings-active")
            })
        }

        allButtons.forEach(button => {
            button.addEventListener("click", () => {
                allButtons.forEach(btn => {
                    btn.style.background = ""
                    button.style.background = "#1d1d1d"
                })
            })
        })

        function toggleSettings() {
            if (settingsHolder.classList.contains("settings-hidden")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (chatHolder.classList.contains("settings-shown")) {
                    toggleChat()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                settingsHolder.classList.remove("settings-hidden")
                settingsHolder.classList.add("settings-shown")
            } else {
                settingsHolder.classList.remove("settings-shown")
                settingsHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }
        function toggleApps() {
            if (appsHolder.classList.contains("settings-hidden")) {
                if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (chatHolder.classList.contains("settings-shown")) {
                    toggleChat()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                appsHolder.classList.remove("settings-hidden")
                appsHolder.classList.add("settings-shown")
            } else {
                appsHolder.classList.remove("settings-shown")
                appsHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }

        function toggleChat() {
            if (chatHolder.classList.contains("settings-hidden")) {
                if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                chatHolder.classList.remove("settings-hidden")
                chatHolder.classList.add("settings-shown")
            } else {
                chatHolder.classList.remove("settings-shown")
                chatHolder.classList.add("settings-hidden")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }
    </script>
    <script>
        let searchE

        const se = localStorage.getItem("breeze_searchEngine") || "DuckDuckGo"
        const bar = document.getElementById("urlbar")

        if (se === "DuckDuckGo") {
            searchE = "https://duckduckgo.com/search?q="
        } else if (se === "Bing") {
            searchE = "https://bing.com/search?q="
        } else if (se === "Google") {
            searchE = "https://google.com/search?q="
        } else if (se === "Startpage") {
            searchE = "https://startpage.com/search?q="
        } else if (se === "https://qwant.com/search?q=") {
            bar.placeholder = "Search with Qwant or enter a URL here"
        } else {
            bar.placeholder = "Search with Brave or enter a URL here"
        }
        connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }])

        function newTab() {
            const nTab = {
                id: tabCounter++,
                title: "New Tab",
                url: "",
                history: [],
                historyIndex: -1,
            };

            bTabs.push(nTab)
            if (!tabCont) return

            const ntBtn = document.querySelector('.newtab')

            const tabElement = document.createElement("div")
            tabElement.classList.add("tab", "hcontainer")
            tabElement.dataset.tabId = nTab.id
            tabElement.innerHTML = `
                <img src="/assets/fav.png" id="fav" data-fav-id="${nTab.id}" width="24" alt="">
                    <span>
                        New Tab
                    </span>
                <i class="fas fa-times close-btn"></i>
                `

            tabElement.addEventListener("click", (e) => {
                if (!e.target.closest(".close-btn")) {
                    switchTab(nTab.id)
                }
            })

            const closebtn = tabElement.querySelector(".close-btn")
            closebtn.addEventListener("click", (e) => {
                e.stopPropagation();
                closeTab(nTab.id);
                console.log("closed tab")
            });

            tabCont.insertBefore(tabElement, ntBtn)

            tabFrame = document.createElement("iframe")
            tabFrame.classList.add("viewframe", "browser-frame")
            tabFrame.dataset.frameId = nTab.id
            tabFrame.setAttribute("allowfullscreen", "true")
            tabFrame.src = "/newtab.html"

            document.body.appendChild(tabFrame)

            switchTab(nTab.id)
        }

        function switchTab(tId) {
            aTab = tId

            document.querySelectorAll(".tab").forEach(tab => {
                tab.classList.toggle("active", parseInt(tab.dataset.tabId) === tId)
            })

            document.querySelectorAll(".viewframe").forEach(frame => {
                frame.classList.toggle("active", parseInt(frame.dataset.frameId) === tId)
            })

            const cTab = bTabs.find(t => t.id === tId)
            if (cTab) {
                const input = document.getElementById("searchbar")
                if (input) input.value = cTab.url
            }
        }


        function closeTab(tId) {
            if (bTabs.length === 1) {
                showToast("error", "Cannot close last tab!", "fas fa-circle-xmark")
                return
            }

            const tIndex = bTabs.findIndex((t) => t.id === tId)
            if (tIndex === -1) return

            bTabs.splice(tIndex, 1)

            const tEl = document.querySelector(`.tab[data-tab-id="${tId}"]`)
            const frame = document.querySelector(`.viewframe[data-frame-id="${tId}"]`)

            if (tEl) tEl.remove()
            if (frame) frame.remove()

            if (aTab === tId) {
                const newATab = bTabs[Math.max(0, tIndex - 1)];
                if (newATab) {
                    switchTab(newATab.id);
                    console.log("woah")
                }
            }
        }

        function nav(i) {
            console.log("e")
            if (!i.trim()) return

            let url = i.trim()

            if (!url.includes(".") || url.includes(" ")) {
                url = searchE + encodeURIComponent(url)
            } else {
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url
                }
            }

            const cTab = bTabs.find((t) => t.id === aTab)
            if (!cTab) return

            cTab.history.push(url)
            cTab.historyIndex++

            cTab.url = url

            if (localStorage.getItem("breeze_backend") === "Scramjet" || localStorage.getItem("breeze_backend") === "scramjet" || !localStorage.getItem("breeze_backend")) {
                fUrl = scramjet.encodeUrl(url)
            } else if (localStorage.getItem("breeze_backend") === "Ultraviolet") {
                fUrl = "/uv/service/" + __uv$config.encodeUrl(url)
            } else {
                fUrl = scramjet.encodeUrl(url)
            }

            go(fUrl)
        }

        function updateUrlFromIframe(viewframe) {
            try {
                const cTab = bTabs.find((t) => t.id === aTab)
                if (!cTab) return

                let decodedUrl
                const currentSrc = viewframe.src

                if (localStorage.getItem("breeze_backend") === "Ultraviolet") {
                    if (currentSrc.includes("/uv/service/")) {
                        decodedUrl = __uv$config.decodeUrl(currentSrc.split("/uv/service/")[1])
                    }
                } else {
                    decodedUrl = scramjet.decodeUrl(currentSrc)
                }

                if (decodedUrl && decodedUrl !== cTab.url) {
                    cTab.url = decodedUrl

                    const ubar = document.getElementById("searchbar")
                    if (ubar) ubar.value = decodedUrl

                    const favEl = document.querySelector(`#fav[data-fav-id="${aTab}"]`)
                    if (favEl) favEl.src = `https://www.google.com/s2/favicons?domain=${decodedUrl}&sz=256`
                }
            } catch (e) {
                console.error("Error updating URL from iframe:", e)
            }
        }

        async function updateSitesVisited() {
            try {
                const user = await getUser();
                if (!user) return;

                const currentSites = user.user_metadata?.sitesVisited || 0;

                const { error } = await window.supabase.auth.updateUser({
                    data: { sitesVisited: currentSites + 1 }
                });

                if (error) throw error;
            } catch (error) {
                console.error('Update sites error:', error);
            }
        }

        async function updTime() {
            try {
                const user = await getUser()
                if (!user) return 

                const currentTime = user.user_metadata?.timeSpentBrowsing ?? 0
                
                console.log("Time spent: " + currentTime)

                const { error } = await window.supabase.auth.updateUser({
                    data: { timeSpentBrowsing: currentTime + 5 }
                })

                if (error) throw error
            } catch (e) {
                console.error("Browse time error: " + e)
            }
        }

        setInterval(updTime, 5000)

        async function updateTimeBrowsing() {
            const user = await getUser()

            const stats = JSON.parse(localStorage.getItem(`breeze_stats_${user.id}`)) || {
                timeSpent: 0,
                sitesVisited: 0,
                activity: []
            }

            stats.timeSpent++
        }

        async function go(u) {
            if (!await connection.getTransport()) {
                connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }])
            }

            console.log("a")
            const cTab = bTabs.find((t) => t.id === aTab)
            const favEl = document.querySelector(`#fav[data-fav-id="${aTab}"]`)
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            if (!viewframe) return

            const ubar = document.getElementById("searchbar")

            const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
            if (tabEl) {
                const titleEl = tabEl.querySelector("span")
                if (titleEl) titleEl.textContent = "Loading..."
            }

            if (ubar) ubar.value = cTab.url
            const favUrl = cTab.url
            if (favEl) favEl.src = `https://www.google.com/s2/favicons?domain=${favUrl}&sz=256`

            try {
                viewframe.src = u
                console.log("ooooo")

                viewframe.onload = () => {
                    try {
                        const iframeDoc = viewframe.contentDocument || viewframe.contentWindow.document
                        const title = iframeDoc.title || new URL(cTab.url).hostname

                        const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
                        if (tabEl) {
                            const titleEl = tabEl.querySelector("span")
                            if (titleEl) titleEl.textContent = title
                        }

                        updateSitesVisited()

                        updateUrlFromIframe(viewframe)
                    } catch (e) {
                        console.error("Error accessing iframe content:", e)
                        const tabEl = document.querySelector(`.tab[data-tab-id="${aTab}"]`)
                        if (tabEl) {
                            const titleEl = tabEl.querySelector("span")
                            if (titleEl) titleEl.textContent = new URL(cTab.url).hostname
                        }

                        updateUrlFromIframe(viewframe)
                    }
                }
            } catch (e) {
                console.error("There was an error while loading the page:", e)
                showToast("error", "There was a problem loading the page. Check the console for more info.", "fas fa-times-circle")
            }
        }

        function b() {
            const cTab = bTabs.find((t) => t.id === aTab)
            if (!cTab || cTab.historyIndex <= 0) return;

            cTab.historyIndex--
            const u = cTab.history[cTab.historyIndex]
            cTab.url = u
            let furl
            const ba = localStorage.getItem("breeze_backend")
            if (ba.toLowerCase() === "scramjet") {
                furl = scramjet.encodeUrl(u)
            } else if (ba.toLowerCase() === "ultraviolet") {
                furl = __uv$config.prefix + __uv$config.encodeUrl(u)
            } else {
                furl = scramjet.encodeUrl(u)
            }

            go(furl)
        }

        function f() {
            const cTab = bTabs.find((t) => t.id === aTab)

            cTab.historyIndex++
            const u = cTab.history[cTab.historyIndex]
            cTab.url = u
            let furl
            const ba = localStorage.getItem("breeze_backend")
            if (ba.toLowerCase() === "scramjet") {
                furl = scramjet.encodeUrl(u)
            } else if (ba.toLowerCase() === "ultraviolet") {
                furl = __uv$config.prefix + __uv$config.encodeUrl(u)
            } else {
                furl = scramjet.encodeUrl(u)
            }

            go(furl)
        }

        function r() {
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            const curl = viewframe.src

            viewframe.src = curl
        }

        function full() {
            const viewframe = document.querySelector(`.viewframe[data-frame-id="${aTab}"]`)
            viewframe.requestFullscreen()
            console.log("sdfkjhasdkjhfg")
        }

        function hideBrowser() {
            const b = document.querySelector(".browser-container")
            const frames = document.querySelectorAll(".viewframe")
            b.style.opacity = 0
            frames.forEach(frame => {
                frame.style.opacity = 0
                frame.style.pointerEvents = "none"
            })
            b.style.pointerEvents = "none"
        }

        async function launchEruda() {
            showToast("info", "Launching Eruda...", "fas fa-info-circle")
            try {
                eruda.init();
                showToast("success", "Successfully injected Eruda", "fa-solid fa-check-circle")
            } catch (e) {
                showToast("error", "Failed to inject Eruda", "fas fa-times-circle")
            }
        }

        let userStats = {
            timeSpent: 0,
            sitesVisited: 0,
            recentActivity: []
        };

        function toggleDashboard() {
            const dashboard = document.querySelector(".dashboard-container");
            if (dashboard.classList.contains("settings-hidden")) {
                if (document.querySelector(".apps-wrapper").classList.contains("settings-shown")) {
                    toggleApps();
                }
                if (document.querySelector(".settings-container").classList.contains("settings-shown")) {
                    toggleSettings();
                }
                if (document.querySelector(".auth-container").classList.contains("settings-shown")) {
                    toggleAuth();
                }
                const newBlurOverlay = document.createElement("div");
                newBlurOverlay.classList.add("blurOverlay");
                document.body.appendChild(newBlurOverlay);
                dashboard.classList.remove("settings-hidden");
                dashboard.classList.add("settings-shown");
                loadDashboard();
            } else {
                dashboard.classList.remove("settings-shown");
                dashboard.classList.add("settings-hidden");
                document.querySelector(".blurOverlay")?.remove();
            }
        }

        async function loadDashboard() {
            const user = await getUser();
            if (!user) return;

            document.getElementById("dashboard-username").textContent = user.user_metadata?.username || user.email.split("@")[0];
            document.getElementById("dashboard-email").textContent = user.email;

            if (user.user_metadata?.avatar_url) {
                document.getElementById("dashboard-pfp").src = user.user_metadata.avatar_url;
            }

            const accountAge = Math.floor((Date.now() - new Date(user.created_at).getTime()) / (1000 * 60 * 60 * 24));
            document.getElementById("account-age").textContent = `${accountAge}d`;
            console.log(`Current account age: ${accountAge}`)

            const stats = JSON.parse(localStorage.getItem(`breeze_stats_${user.id}`));

            const hours = Math.floor(user.user_metadata?.timeSpentBrowsing / 3600);
            const minutes = Math.floor(user.user_metadata?.timeSpentBrowsing % 3600 / 60);
            document.getElementById("time-spent").textContent = `${hours}h ${minutes}m`;
            console.log(`Total Time: ${hours}h, ${minutes}m`)
            document.getElementById("sites-visited").textContent = user.user_metadata?.sitesVisited || 0;
            console.log(`Total sites visited: ${user.user_metadata?.sitesVisited}`)

            const activityList = document.getElementById("recent-activity");
            if (stats.activity && stats.activity.length > 0) {
                activityList.innerHTML = stats.activity.slice(-10).reverse().map(item => `
            <div class="activity-item">
                <p>${item.url}</p>
                <span>${new Date(item.time).toLocaleTimeString()}</span>
            </div>
        `).join('');
            }
        }

        document.getElementById('pfp-upload').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (event) => {
                const base64 = event.target.result;

                try {
                    const { error } = await window.supabase.auth.updateUser({
                        data: { avatar_url: base64 }
                    });

                    if (error) throw error;

                    document.getElementById("dashboard-pfp").src = base64;
                    showToast("success", "Profile picture updated!", "fas fa-check-circle");
                } catch (e) {
                    showToast("error", e.message, "fas fa-times-circle");
                }
            };
            reader.readAsDataURL(file);
        });

        async function changeUsername() {
            const newUsername = prompt("Enter new username:");
            if (!newUsername) return;

            try {
                const { error } = await window.supabase.auth.updateUser({
                    data: { username: newUsername }
                });

                if (error) throw error;

                document.getElementById("dashboard-username").textContent = newUsername;
                showToast("success", "Username updated!", "fas fa-check-circle");
            } catch (e) {
                showToast("error", e.message, "fas fa-times-circle");
            }
        }

        async function changePassword() {
            const newPassword = prompt("Enter new password:");
            if (!newPassword) return;

            try {
                const { error } = await window.supabase.auth.updateUser({
                    password: newPassword
                });

                if (error) throw error;

                showToast("success", "Password updated!", "fas fa-check-circle");
            } catch (e) {
                showToast("error", e.message, "fas fa-times-circle");
            }
        }

        setInterval(async () => {
            const user = await getUser();
            if (user) {
                const stats = JSON.parse(localStorage.getItem(`breeze_stats_${user.id}`)) || { timeSpent: 0, sitesVisited: 0, activity: [] };
                stats.timeSpent += 1;
                console.log("Time updated: " + stats.timeSpent)
                console.log("Minutes total: " + Math.floor(stats.timeSpent % 3600 / 60))
                localStorage.setItem(`breeze_stats_${user.id}`, JSON.stringify(stats));
            }
        }, 1000);

        const homesearch = document.getElementById("homesearch");

        function rSearch(input) {
            let url = input;
            if (!url.includes(".") || url.includes(" ")) {
                url = "https://search.brave.com/search?q=" + url;
            } else {
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url;
                }
            }

            const b = document.querySelector(".browser-container")
            const frames = document.querySelectorAll(".viewframe")

            b.style.opacity = 1
            b.style.pointerEvents = "all"

            frames.forEach(frame => {
                frame.style.opacity = 1
                frame.style.pointerEvents = "all"
            })

            console.log("rSearch")
            newTab()
            nav(url)
            switchTab(aTab)
        }

        homesearch.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                rSearch(homesearch?.value.trim());
                console.log("rsearching")
            }
            console.log("check")
        });

        const browserWindow = document.querySelector(".browser-container")

        document.addEventListener("keydown", e => {
            if (e.ctrlKey && e.key === "t" && browserWindow.classList.contains("active")) {
                newTab()
            } else if (e.ctrlKey && e.key === "w" && browserWindow.classList.contains("active")) {
                closeTab(bTabs.length)
            }

    </script>
